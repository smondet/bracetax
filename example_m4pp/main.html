<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
    <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <!-- Generated with BraceTax -->
    <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet"  type="text/css" href="../brtxdoc.css" />
<title>Bracetax Example</title>
    </head>
    <body>
<div class="header">

  <h1>Self-documenting authoring example</h1>
  <div class="authors">Sebastien Mondet</div>
  <div class="subtitle">Using m4&hellip;</div>
</div> <!-- END HEADER -->
<div class="p">
  </div>
<h2 id="sec_links">Some links</h2>
<div class="p">  We will use <a href="http://en.wikipedia.org/wiki/M4_(computer_language)">M4</a>   </div>
<h2 id="sec_examples">Detailled examples</h2>
<div class="p">  </div>
<h3 id="sec_def_todo">Creating a &ldquo;ToDo&rdquo; tag</h3>
<div class="p">    Here is the M4 code: 
<!--verbatimbegin:m4_code -->
<pre>
define(TODO, ifelse(_output_format, HTML ,
{bypass end}&lt;span style="color: red; background-color: yellow"&gt;TO-DO&lt;/span&gt;{end},
{bypass end}\textcolor{red}{TO-DO}{end}))dnl
</pre>
<!--verbatimend:m4_code -->
 so, with the command: 
<!--verbatimbegin:shell_code -->
<pre>
m4  -D_output_format="LATEX"  main.brtx | brtx [-html|-latex]
</pre>
<!--verbatimend:shell_code -->
 with a <tt>TODO</tt>, the output generated by <tt>brtx</tt>, will have a <span style="color: red; background-color: yellow">TO-DO</span>    </div>
<h3 id="sec_date_command">Using command line definitions</h3>
<div class="p">  Here we have the compilation date: <tt>Sun Oct  2 14:40:43 EDT 2011</tt> </div>
<div class="p"> For that we just passed the source: 
<!--verbatimbegin:brtx_code -->
<pre>
Here we have compilation date: {t|_todaydate}
</pre>
<!--verbatimend:brtx_code -->
 through the command: 
<!--verbatimbegin:shell_code -->
<pre>
m4 -D_todaydate="$(date)" main.brtx &gt; main.brtx.tmp
</pre>
<!--verbatimend:shell_code -->
  </div>
<h3 id="sec_biblio">Citations</h3>
<div class="p">  Let's say we want to use BibTeX for LaTeX output and that we have a bibliography site (<tt>./biblio/&lt;refname&gt;.html</tt> or <tt>./biblio.html#&lt;refname&gt;</tt>).   We define CITATION: <pre>
define(CITATION, ifelse(_output_format , HTML,
[{link ./biblio/$1.html|$1}],
{bypass end}\cite{$1}{end}))dnl
</pre> so that <pre>
CITATION(mondet08bracetax)
</pre> will give us: <pre>
[{link ./biblio/mondet08bracetax.html|mondet08bracetax}]
</pre>   </div>
<h3 id="sec_include">Using <tt>include</tt></h3>
<div class="p">  With a simple: 
<!--verbatimbegin:brtx_code -->
<pre>
{code verycomplexend}
include(./Makefile)
{verycomplexend}
</pre>
<!--verbatimend:brtx_code -->
 we obtain: <pre>

EXAMPLE_SITE_HTML=main.html main.tex

EXAMPLE_SITE_VIM= Makefile.html main.brtx.html

EXAMPLE_SITE= $(EXAMPLE_SITE_HTML) $(EXAMPLE_SITE_VIM) main.pdf main.tex

all: $(EXAMPLE_SITE)

.PHONY: nopdf

nopdf: $(EXAMPLE_SITE_HTML) $(EXAMPLE_SITE_VIM)

#
# Generate the HTML page from source:
#                         m4              brtx -html       brtx -prospro    
#   source bracetax + M4 ---&gt; pure bracetax  ---&gt;    HTML       ---&gt;     HTML
#
HEVEA_OR_NOT= hevea || echo NoHeveaFound
main.html: main.brtx
	m4 -D_todaydate="date`" -D_output_format="HTML" main.brtx &gt; main.brtx.tmp
	$(BRTX2HTML) -doc -title "Bracetax Example" -link-css ../$(CSS) \
	    -i main.brtx.tmp -o $@
	rm main.brtx.tmp


#
# Generate the HTML page from source:
#                         m4              brtx -html       brtx -prospro    
#   source bracetax + M4 ---&gt; pure bracetax  ---&gt;    HTML       ---&gt;     HTML
#
main.tex: main.brtx
	m4 -D_todaydate="`date`" -D_output_format="LATEX" main.brtx &gt; main.brtx.tmp
	brtx -doc -title "Self Documenting Example" -latex  -i main.brtx.tmp -o main.tex
	rm main.brtx.tmp 

#
# A PDF with pdflatex
#
main.pdf: main.tex
	pdflatex main &amp;&amp; pdflatex main
	rm main.log main.aux main.out

#
# Using VIM to generate an HTML page from a source code
#
Makefile.html: Makefile
	vim -f -R $&lt; \
		-c "sy on" \
		-c 'colorscheme darkblue' \
		-c TOhtml -c 'w! $@.tmp -c 'qa!' &amp;&amp; \
	sed -e 's/&lt;title&gt;.*&lt;\/title&gt;/&lt;title&gt;Makefile&lt;\/title&gt;/' \
		$@.tmp &gt; $@
	rm -f $@.tmp

#
# Using VIM to generate an HTML page from a source code
# (with the provided - incomplete - vim plugin
#
main.brtx.html: main.brtx
	vim -f -R $&lt; \
		-c "sy on" \
		-c 'colorscheme darkblue' \
		-c 'source ../../../tools/bracetax_syntax.vim' \
		-c TOhtml -c 'w! $@.tmp' -c 'qa!' &amp;&amp; \
	sed -e 's/&lt;title&gt;.*&lt;\/title&gt;/&lt;title&gt;Example - source&lt;\/title&gt;/' \
		$@.tmp &gt; $@ 
	rm -f $@.tmp


</pre>   </div>
</body>
</html>
