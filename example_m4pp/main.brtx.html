<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>Example - source</title>
<meta name="Generator" content="Vim/7.3">
<meta name="plugin-version" content="vim7.3_v6">
<meta name="syntax" content="bracetax">
<meta name="settings" content="use_css">
<style type="text/css">
<!--
pre { font-family: monospace; color: #ffffff; background-color: #808080; }
body { font-family: monospace; color: #ffffff; background-color: #808080; }
.Comment { color: #ff6060; }
.Special { color: #ffff00; }
.PreProc { color: #ff40ff; }
.Identifier { color: #00ffff; }
.Statement { color: #ffff00; }
-->
</style>
</head>
<body>
<pre>

<span class="Statement">{</span><span class="Identifier">header</span><span class="Statement">|</span>
    <span class="Statement">{</span><span class="Identifier">title</span><span class="Statement">|</span>Self-documenting authoring example<span class="Statement">}</span>
    <span class="Statement">{</span><span class="Identifier">authors</span><span class="Statement">|</span>Sebastien Mondet<span class="Statement">}</span>
    <span class="Statement">{</span><span class="Identifier">subtitle</span><span class="Statement">|</span>Using m4<span class="Statement">{</span><span class="Identifier">...</span><span class="Statement">}}</span>
<span class="Statement">}</span>

<span class="Statement">{</span><span class="Identifier">section</span><span class="PreProc"> 1 sec_links</span><span class="Statement">|</span>Some links<span class="Statement">}</span>

We will use <span class="Statement">{</span><span class="Identifier">link</span><span class="PreProc"> <a href="http://en.wikipedia.org/wiki/M4_(computer_language)">http://en.wikipedia.org/wiki/M4_(computer_language)</a></span><span class="Statement">|</span>M4<span class="Statement">}</span>

<span class="Statement">{</span><span class="Identifier">section</span><span class="PreProc"> 1 sec_examples</span><span class="Statement">|</span>Detailled examples<span class="Statement">}</span>

<span class="Statement">{</span><span class="Identifier">section</span><span class="PreProc"> 2 sec_def_todo</span><span class="Statement">|</span>Creating a <span class="Statement">{</span><span class="Identifier">q</span><span class="Statement">|</span>ToDo<span class="Statement">}</span> tag<span class="Statement">}</span>


define(`TODO', ifelse(_output_format , HTML ,
`<span class="Special">{bypass end}&lt;span style=&quot;color: red; background-color: yellow&quot;&gt;TO-DO&lt;/span&gt;{end}</span>',
`<span class="Special">{bypass end}\textcolor{red}{TO-DO}{end}</span>'))dnl

Here is the M4 code:
<span class="Comment"># (We need to escape M4 commands)</span>
<span class="Special">{code e m4_code}</span>
<span class="Special">`define'(`TODO', `ifelse'(`_output_format', HTML ,</span>
<span class="Special">`{bypass end}&lt;span style=&quot;color: red; background-color: yellow&quot;&gt;TO-DO&lt;/span&gt;{end}',</span>
<span class="Special">`{bypass end}\textcolor{red}{TO-DO}{end}'))`dnl'</span>
<span class="Special">{e}</span>
so, with the command:
<span class="Special">{code e shell_code}</span>
<span class="Special">m4  -D_output_format=&quot;LATEX&quot;  main.brtx | brtx [-html|-latex]</span>
<span class="Special">{e}</span>
with a <span class="Statement">{</span><span class="Identifier">t</span><span class="Statement">|</span>`TODO'<span class="Statement">}</span>, the output generated by <span class="Statement">{</span><span class="Identifier">t</span><span class="Statement">|</span>brtx<span class="Statement">}</span>, will have a TODO

<span class="Comment">## {section 2 sec_latex_command|Defining the {t|LATEX} command}</span>
<span class="Comment">## </span>
<span class="Comment">## define(`LATEX',{verbatim verycomplexend latex}</span>
<span class="Comment">## $1</span>
<span class="Comment">## {verycomplexend}')</span>
<span class="Comment">## Quite simply:</span>
<span class="Comment">## {verbatim eee}</span>
<span class="Comment">## # define(`LATEX',{verbatim verycomplexend latex}</span>
<span class="Comment">## # $1</span>
<span class="Comment">## # {verycomplexend}')</span>
<span class="Comment">## {eee}</span>
<span class="Comment">## </span>
<span class="Comment">## And then:</span>
<span class="Comment">## {verbatim eee}</span>
<span class="Comment">## `LATEX'(Some {\bf bold} and $m = a^{th}_{ematics}$)</span>
<span class="Comment">## {eee}</span>
<span class="Comment">## will generate:</span>
<span class="Comment">## {verbatim eee}</span>
<span class="Comment">## LATEX(Some {\bf bold} and $m = a^{th}_{ematics}$)</span>
<span class="Comment">## {eee}</span>
<span class="Comment">## With post-processing, for LaTeX output:</span>
<span class="Comment">## {verbatim}</span>
<span class="Comment">## brtx -postpro -pp inlinelatex -i ... -o ...</span>
<span class="Comment">## {endverbatim}</span>
<span class="Comment">## and for HTML output (needs {link <a href="http://hevea.inria.fr/|Hevea">http://hevea.inria.fr/|Hevea</a>} to convert from</span>
<span class="Comment">## LaTeX to HTML):</span>
<span class="Comment">## {verbatim}</span>
<span class="Comment">## brtx -postpro -pp latex2html:hevea -i ... -o ...</span>
<span class="Comment">## {endverbatim}</span>
<span class="Comment">## we get:</span>
<span class="Comment">## LATEX(Some {\bf bold} and $m = a^{th}_{ematics}$)</span>


<span class="Statement">{</span><span class="Identifier">section</span><span class="PreProc"> 2 sec_date_command</span><span class="Statement">|</span>Using command line definitions<span class="Statement">}</span>

Here we have the compilation date: <span class="Statement">{</span><span class="Identifier">t</span><span class="Statement">|</span>_todaydate<span class="Statement">}</span>
<span class="Statement">{</span><span class="Identifier">p</span><span class="Statement">}</span>
For that we just passed the source:
<span class="Special">{code e brtx_code}</span>
<span class="Special">Here we have compilation date: {t|`_todaydate'}</span>
<span class="Special">{e}</span>
through the command:
<span class="Special">{code e shell_code}</span>
<span class="Special">m4 -D`_todaydate'=&quot;$(date)&quot; main.brtx &gt; main.brtx.tmp</span>
<span class="Special">{e}</span>

<span class="Statement">{</span><span class="Identifier">section</span><span class="PreProc"> 2 sec_biblio</span><span class="Statement">|</span>Citations<span class="Statement">}</span>

Let's say we want to use BibTeX for LaTeX output and that we have a
bibliography site (<span class="Statement">{</span><span class="Identifier">t</span><span class="Statement">|</span>./biblio/&lt;refname&gt;.html<span class="Statement">}</span> or
<span class="Statement">{</span><span class="Identifier">t</span><span class="Statement">|</span>./biblio.html<span class="Statement">{</span><span class="Identifier">#</span><span class="Statement">}</span>&lt;refname&gt;<span class="Statement">}</span>).

define(`CITATION', ifelse(_output_format , HTML ,
`[<span class="Statement">{</span><span class="Identifier">link</span><span class="PreProc"> ./biblio/$1.html</span><span class="Statement">|</span>$1<span class="Statement">}</span>]',
`<span class="Special">{bypass end}\cite{$1}{end}</span>'))dnl

We define `CITATION':
<span class="Special">{code eee}</span>
<span class="Special">`define'(`CITATION', `ifelse'(`_output_format' , HTML,</span>
<span class="Special">[{link ./biblio/$1.html|$1}],</span>
<span class="Special">`{bypass end}\cite{$1}{end}'))`dnl'</span>
<span class="Special">{eee}</span>
so that
<span class="Special">{code eee}</span>
<span class="Special">`CITATION'(mondet08bracetax)</span>
<span class="Special">{eee}</span>
will give us:
<span class="Special">{code eee}</span>
<span class="Special">CITATION(mondet08bracetax)</span>
<span class="Special">{eee}</span>


<span class="Statement">{</span><span class="Identifier">section</span><span class="PreProc"> 2 sec_include</span><span class="Statement">|</span>Using <span class="Statement">{</span><span class="Identifier">t</span><span class="Statement">|</span>include<span class="Statement">}}</span>

With a simple:
<span class="Special">{code e brtx_code}</span>
<span class="Special">{code verycomplexend}</span>
<span class="Special">`include'(./Makefile)</span>
<span class="Special">{verycomplexend}</span>
<span class="Special">{e}</span>
we obtain:
<span class="Special">{code verycomplexend}</span>
<span class="Special">include(./Makefile)</span>
<span class="Special">{verycomplexend}</span>


</pre>
</body>
</html>
